<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Django3+Python3_in_AWS_Lightsail.md - GridBlog</title><meta name="gridsome:hash" content="ef5a31b6d4f2ef30b559c2fd01d93591a31d3391"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/gridblog/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/gridblog/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/gridblog/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/gridblog/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/gridblog/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/gridblog/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/gridblog/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/gridblog/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/gridblog/assets/css/0.styles.298cab45.css" as="style"><link rel="preload" href="/gridblog/assets/js/app.883dac62.js" as="script"><link rel="preload" href="/gridblog/assets/js/page--src--templates--blog-vue.9cd07c6b.js" as="script"><link rel="prefetch" href="/gridblog/assets/js/page--node-modules--gridsome-0-7-23-gridsome--app--pages--404-vue.ef77c877.js"><link rel="prefetch" href="/gridblog/assets/js/page--src--pages--about-vue.6d4736fa.js"><link rel="prefetch" href="/gridblog/assets/js/page--src--pages--blogs-vue.5707b741.js"><link rel="prefetch" href="/gridblog/assets/js/page--src--pages--index-vue.340646fc.js"><link rel="prefetch" href="/gridblog/assets/js/page--src--pages--repos-vue.6198e4f7.js"><link rel="prefetch" href="/gridblog/assets/js/page--src--templates--repo-vue.4d44b054.js"><link rel="prefetch" href="/gridblog/assets/js/vendors~page--src--pages--index-vue~page--src--templates--blog-vue.a5781449.js"><link rel="stylesheet" href="/gridblog/assets/css/0.styles.298cab45.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" class="layout"><header class="header"><strong><a href="/gridblog/" class="active">GridBlog</a></strong><nav class="nav"><a href="/gridblog/" class="nav__link active">Home</a><a href="/gridblog/repos/" class="nav__link">Repos</a><a href="/gridblog/blogs/" class="nav__link">Blog</a><a href="/gridblog/about/" class="nav__link">About</a></nav></header><div><h1>Django3+Python3_in_AWS_Lightsail.md</h1><div><p>sudo apt-get update &amp;&amp; sudo apt-get upgrade</p>
<p>sudo apt install python3-pip python3-dev libpq-dev postgresql postgresql-contrib nginx curl</p>
<p>sudo -H pip3 install --upgrade pip
sudo -H pip3 install virtualenv</p>
<p>sudo -u postgres psql</p>
<p>CREATE DATABASE myproject;<br>
CREATE USER myprojectuser WITH PASSWORD 'password';<br>
ALTER ROLE myprojectuser SET client_encoding TO 'utf8';<br>
ALTER ROLE myprojectuser SET default_transaction_isolation TO 'read committed';<br>
ALTER ROLE myprojectuser SET timezone TO 'UTC';<br>
GRANT ALL PRIVILEGES ON DATABASE myproject TO myprojectuser;<br>
\q</p>
<p>git clone Django-repo/HTTP/address
cd project_directory<br>
virtualenv venv<br>
source venv/bin/activate<br>
python -m pip install --upgrade pip</p>
<p>(venv)$ pip install -r requirements.txt<br>
//some settings with <code>settings.py</code>(STATIC_ROOT, postgres db setup, ALLOWED_HOTSTS), <code>.env</code> (SECZRET_KEY export) etc.</p>
<p>(venv)$ python manage.py migrate</p>
<p>(venv)$ python manage.py collectstatic<br>
//activate a port of 8000 under 'networking' tag in the control panel on Lightsail page.<br>
(venv)$ python manage.py runserver 0.0.0.0:8000</p>
<p>(venv)$ gunicorn --bind 0.0.0.0:8000 myproject.wsgi</p>
<p>(venv)$ deactivate</p>
<p>sudo nano /etc/systemd/system/gunicorn.socket</p>
<pre><code># /etc/systemd/system/gunicorn.socket
[Unit]
Description=gunicorn socket

[Socket]
ListenStream=/run/gunicorn.sock

[Install]
WantedBy=sockets.target
# save and close
</code></pre>
<p>sudo nano /etc/systemd/system/gunicorn.service</p>
<pre><code>[Unit]
Description=gunicorn daemon
Requires=gunicorn.socket
After=network.target

[Service]
User=sammy
Group=www-data
WorkingDirectory=/home/sammy/myprojectdir
ExecStart=/home/sammy/myprojectdir/myprojectenv/bin/gunicorn \
          --access-logfile - \
          --workers 3 \
          --bind unix:/run/gunicorn.sock \
          myproject.wsgi:application

[Install]
WantedBy=multi-user.target

# Note: User is the system user with writing privilege, so change that, also change 'WorkingDirectory' and 'ExecStart', DO NOT forget 'project_folder_contains_wsgi.wsgi:application'
</code></pre>
<p>sudo systemctl start gunicorn.socket</p>
<p>sudo systemctl enable gunicorn.socket</p>
<p>sudo nano /etc/nginx/sites-available/myproject</p>
<pre><code>server {
    listen 80;
    server_name server_domain_or_IP;

    location = /favicon.ico { access_log off; log_not_found off; }
    location /static/ {
        root /home/sammy/myprojectdir;
    }
    location /media/ {
        root /home/sammy/myprojectdir;
    }
    
    location / {
        include proxy_params;
        proxy_pass http://unix:/run/gunicorn.sock;
    }
}

# save and close the file
</code></pre>
<p>sudo ln -s /etc/nginx/sites-available/myproject /etc/nginx/sites-enabled</p>
<p>sudo nginx -t</p>
<p>sudo systemctl restart nginx</p>
<p>sudo ufw allow 'Nginx Full'</p>
<p>sudo ufw delete allow 'Nginx HTTP'</p>
<p>ufw allow OpenSSH</p>
<p>ufw enable</p>
<p>ufw status</p>
<p>sudo apt install python-certbot-nginx</p>
<p>sudo certbot --nginx -d example.com -d www.example.com</p>
</div><button>Go Back</button></div></div>
    <script>window.__INITIAL_STATE__={"data":{"blog":{"title":"Django3+Python3_in_AWS_Lightsail.md","createdAt":"2020-05-01T09:07:31Z","description":"Commands to install python3, postgres, django3, gunicorn, nginx, cerbotSSL in AWS Lightsail VPS Ubuntu 18.04","address":"https:\u002F\u002Fgist.github.com\u002Fc8eea6f494be8dee82810bf34a1a840a","content":"sudo apt-get update && sudo apt-get upgrade\n\nsudo apt install python3-pip python3-dev libpq-dev postgresql postgresql-contrib nginx curl\n\nsudo -H pip3 install --upgrade pip\nsudo -H pip3 install virtualenv\n\nsudo -u postgres psql\n\nCREATE DATABASE myproject;  \nCREATE USER myprojectuser WITH PASSWORD 'password';  \nALTER ROLE myprojectuser SET client_encoding TO 'utf8';  \nALTER ROLE myprojectuser SET default_transaction_isolation TO 'read committed';  \nALTER ROLE myprojectuser SET timezone TO 'UTC';  \nGRANT ALL PRIVILEGES ON DATABASE myproject TO myprojectuser;  \n\\q\n\ngit clone Django-repo\u002FHTTP\u002Faddress \ncd project_directory  \nvirtualenv venv  \nsource venv\u002Fbin\u002Factivate  \npython -m pip install --upgrade pip\n\n(venv)$ pip install -r requirements.txt  \n\u002F\u002Fsome settings with `settings.py`(STATIC_ROOT, postgres db setup, ALLOWED_HOTSTS), `.env` (SECZRET_KEY export) etc.  \n\n(venv)$ python manage.py migrate\n\n(venv)$ python manage.py collectstatic  \n\u002F\u002Factivate a port of 8000 under 'networking' tag in the control panel on Lightsail page.  \n(venv)$ python manage.py runserver 0.0.0.0:8000  \n\n(venv)$ gunicorn --bind 0.0.0.0:8000 myproject.wsgi\n\n(venv)$ deactivate\n\n\nsudo nano \u002Fetc\u002Fsystemd\u002Fsystem\u002Fgunicorn.socket\n```\n# \u002Fetc\u002Fsystemd\u002Fsystem\u002Fgunicorn.socket\n[Unit]\nDescription=gunicorn socket\n\n[Socket]\nListenStream=\u002Frun\u002Fgunicorn.sock\n\n[Install]\nWantedBy=sockets.target\n# save and close\n```\n\nsudo nano \u002Fetc\u002Fsystemd\u002Fsystem\u002Fgunicorn.service\n```\n[Unit]\nDescription=gunicorn daemon\nRequires=gunicorn.socket\nAfter=network.target\n\n[Service]\nUser=sammy\nGroup=www-data\nWorkingDirectory=\u002Fhome\u002Fsammy\u002Fmyprojectdir\nExecStart=\u002Fhome\u002Fsammy\u002Fmyprojectdir\u002Fmyprojectenv\u002Fbin\u002Fgunicorn \\\n          --access-logfile - \\\n          --workers 3 \\\n          --bind unix:\u002Frun\u002Fgunicorn.sock \\\n          myproject.wsgi:application\n\n[Install]\nWantedBy=multi-user.target\n\n# Note: User is the system user with writing privilege, so change that, also change 'WorkingDirectory' and 'ExecStart', DO NOT forget 'project_folder_contains_wsgi.wsgi:application'\n```\n\nsudo systemctl start gunicorn.socket\n\nsudo systemctl enable gunicorn.socket\n\n\nsudo nano \u002Fetc\u002Fnginx\u002Fsites-available\u002Fmyproject\n```\nserver {\n    listen 80;\n    server_name server_domain_or_IP;\n\n    location = \u002Ffavicon.ico { access_log off; log_not_found off; }\n    location \u002Fstatic\u002F {\n        root \u002Fhome\u002Fsammy\u002Fmyprojectdir;\n    }\n    location \u002Fmedia\u002F {\n        root \u002Fhome\u002Fsammy\u002Fmyprojectdir;\n    }\n    \n    location \u002F {\n        include proxy_params;\n        proxy_pass http:\u002F\u002Funix:\u002Frun\u002Fgunicorn.sock;\n    }\n}\n\n# save and close the file\n```\n\nsudo ln -s \u002Fetc\u002Fnginx\u002Fsites-available\u002Fmyproject \u002Fetc\u002Fnginx\u002Fsites-enabled\n\nsudo nginx -t\n\nsudo systemctl restart nginx\n\n\nsudo ufw allow 'Nginx Full'\n\nsudo ufw delete allow 'Nginx HTTP'\n\nufw allow OpenSSH\n\nufw enable\n\nufw status\n\n\n\nsudo apt install python-certbot-nginx\n\nsudo certbot --nginx -d example.com -d www.example.com\n\n"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/gridblog/assets/js/app.883dac62.js" defer></script><script src="/gridblog/assets/js/page--src--templates--blog-vue.9cd07c6b.js" defer></script>
  </body>
</html>
